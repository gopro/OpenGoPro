Live Streaming
==============

The camera supports the ability to stream to social media platforms such as Twitch, YouTube, Facebook or any other site
that accepts RTMP(S) URLs.

The livestream is transferred via RTMP as AVC/h264. For additional details about getting started with RTMP, see
`How to Stream <https://gopro.com/en/us/news/how-to-live-stream-on-gopro>`__.

Live streaming with camera is accomplished as follows:

1. Put the camera into :doc:`Station Mode<access_points>` and connect it to an access point
2. Use :operation:ref:`Set Livestream Mode` to configure livestreaming.
3. Poll for :operation:ref:`Livestream Status<Get Livestream Status>` until the camera indicates it is ready
4. Set the shutter to begin live streaming
5. Unset the shutter to stop live streaming

.. image:: ../../assets/images/plantuml_ble_live_streaming.png

Metadata
--------

The following fields are reported as `RTMP Metadata <https://rtmp.veriskope.com/docs/spec/#712data-message-18-15>`__ :

- creator (string) = "GoPro Hero"
- encoder  (string) = "<Serial Number>"  (eg. "C35313DVT1X220")
- width (number) = stream resolution width
- height (number) = stream resolution height
- videodatarate (number) = stream bitrate
- framerate (number) = stream framerate
- videocodecid (number) = 7
- audiocodecid (number) = 10
- audiodatarate (number) = audio bitrate
- audiosamplerate (number) = audio sample rate
- audiosamplesize (number) = 16
- stero (boolean) = True if audio has 2 channels, False otherwise
- filesize (number) = size of the file (edited)

Operations
----------

.. operation:protobuf:: Set Livestream Mode
    :operation-id: GPCAMERA_LIVE_STREAM_SETUP
    :external:

    .. note:: The current Livestream Mode can be queried via :operation:ref:`Get Livestream Status`

    .. operation:protobuf-message:: request
        :feature-id: 0xF1
        :action-id: 0x79
        :uuid: Command
        :message: WSDK_RequestSetLiveStreamMode

    .. operation:protobuf-message:: response
        :feature-id: 0xF1
        :action-id: 0xF9
        :uuid: Command Response
        :message: ResponseGeneric

.. operation:protobuf:: Get Livestream Status
    :operation-id: OGP_LIVESTREAM_STATUS
    :external:

    .. operation:protobuf-message:: request
        :feature-id: 0xF5
        :action-id: 0x74
        :uuid: Query
        :message: WSDK_RequestGetLiveStreamStatus

    .. operation:protobuf-message:: response
        :feature-id: 0xF5
        :action-id: 0xF4
        :uuid: Query Response
        :message: WSDK_NotifyLiveStreamStatus

    .. operation:protobuf-message:: notification
        :feature-id: 0xF5
        :action-id: 0xF5
        :uuid: Query Response
        :message: WSDK_NotifyLiveStreamStatus
