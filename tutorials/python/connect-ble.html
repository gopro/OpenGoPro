<!DOCTYPE html>
<!--
  Minimal Mistakes Jekyll Theme 4.23.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
--><html lang="en" class="no-js">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Python Tutorial 1: Connect BLE :  Open GoPro</title>
<meta name="description" content="Python Tutorial 1: Connect BLE">


  <meta name="author" content="GoPro">
  
  <meta property="article:author" content="GoPro">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Open GoPro">
<meta property="og:title" content="Python Tutorial 1: Connect BLE">
<meta property="og:url" content="/OpenGoPro/tutorials/python/connect-ble">


  <meta property="og:description" content="Python Tutorial 1: Connect BLE">







  <meta property="article:published_time" content="2021-05-26T11:45:09-07:00">






<link rel="canonical" href="/OpenGoPro/tutorials/python/connect-ble">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "GoPro",
      "url": "/OpenGoPro/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/OpenGoPro/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    <script src="/OpenGoPro/assets/js/tabs.js"></script>
  
    <script src="/OpenGoPro/assets/js/quiz.js"></script>
  

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/logos/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/logos/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/logos/favicon-16x16.png">
<link rel="manifest" href="/assets/images/logos/site.webmanifest">
<link rel="mask-icon" href="/assets/images/logos/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/images/logos/favicon.ico">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="msapplication-config" content="/assets/images/logos/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/OpenGoPro/"><img src="/OpenGoPro/assets/images/logos/logo.png" alt="Open GoPro"></a>
        
        <a class="site-title" href="/OpenGoPro/">
          Open GoPro
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/OpenGoPro/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="https://github.com/gopro/OpenGoPro">View on Github</a>
            </li>
<li class="masthead__menu-item">
              <a href="/OpenGoPro/ble">BLE Spec</a>
            </li>
<li class="masthead__menu-item">
              <a href="/OpenGoPro/wifi">WiFi Spec</a>
            </li>
<li class="masthead__menu-item">
              <a href="/OpenGoPro/tutorials">Tutorials</a>
            </li>
<li class="masthead__menu-item">
              <a href="/OpenGoPro/demos">Demos</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/OpenGoPro/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/OpenGoPro/tutorials" itemprop="item"><span itemprop="name">Tutorials</span></a>
          <meta itemprop="position" content="2">
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/OpenGoPro/python" itemprop="item"><span itemprop="name">Python</span></a>
          <meta itemprop="position" content="3">
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Python Tutorial 1: Connect BLE</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/OpenGoPro/assets/images/logos/logo_square.png" alt="GoPro" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">GoPro</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Be a <strong>hero</strong>.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">US</span>
        </li>
      

      
        
          
            <li><a href="https://www.gopro.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://twitter.com/GoPro" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://www.facebook.com/gopro/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://github.com/gopro" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.instagram.com/gopro/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox">
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <a href="/OpenGoPro/tutorials/python/connect-ble"><span class="nav__sub-title">1: Connect BLE</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/OpenGoPro/tutorials/python/send-ble-commands"><span class="nav__sub-title">2: Send BLE Commands</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/OpenGoPro/tutorials/python/parse-ble-responses"><span class="nav__sub-title">3: Parse BLE TLV Responses</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/OpenGoPro/tutorials/python/ble-queries"><span class="nav__sub-title">4: BLE Queries</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/OpenGoPro/tutorials/python/connect-wifi"><span class="nav__sub-title">5: Connect WiFi</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/OpenGoPro/tutorials/python/send-wifi-commands"><span class="nav__sub-title">6: Send WiFi Commands</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/OpenGoPro/tutorials/python/camera-media-list"><span class="nav__sub-title">7: Camera Media List</span></a>
        

        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Python Tutorial 1: Connect BLE">
    <meta itemprop="description" content="Python Tutorial 1: Connect BLE">
    <meta itemprop="datePublished" content="2021-05-26T11:45:09-07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Python Tutorial 1: Connect BLE
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
<li>
<a href="#requirements">Requirements</a><ul>
<li><a href="#hardware">Hardware</a></li>
<li>
<a href="#software">Software</a><ul>
<li><a href="#python">Python</a></li>
<li><a href="#tutorials-package">Tutorials Package</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#basic-ble-tutorial">Basic BLE Tutorial</a><ul>
<li><a href="#just-show-me-the-demo">Just Show me the Demo!!</a></li>
<li><a href="#asyncio">Asyncio</a></li>
<li><a href="#advertise">Advertise</a></li>
<li><a href="#scan">Scan</a></li>
<li><a href="#connect">Connect</a></li>
<li><a href="#pair">Pair</a></li>
<li><a href="#enable-notifications">Enable Notifications</a></li>
</ul>
</li>
<li>
<a href="#troubleshooting">Troubleshooting</a><ul>
<li><a href="#complete-system-reset">Complete System Reset</a></li>
<li><a href="#logs">Logs</a></li>
</ul>
</li>
<li><a href="#good-job">Good Job!</a></li>
</ul>

            </nav>
          </aside>
        
        <p>This tutorial will provide a walk-through to connect to the GoPro camera via BLE using
<a href="https://bleak.readthedocs.io/en/latest/">bleak</a>.</p>

<h1 id="requirements">Requirements</h1>

<h2 id="hardware">Hardware</h2>

<ol>
  <li>
    <p>One of the following systems:</p>

    <ul>
      <li>Windows 10, version 16299 (Fall Creators Update) or greater</li>
      <li>Linux distribution with <a href="http://www.bluez.org/">BlueZ</a> &gt;= 5.43</li>
      <li>OS X/macOS support via Core Bluetooth API, from at least OS X version 10.11</li>
    </ul>
  </li>
  <li>
    <p>A GoPro camera that is <a href="/OpenGoPro/ble#supported-cameras">supported by Open GoPro</a></p>
  </li>
</ol>

<h2 id="software">Software</h2>

<h3 id="python">Python</h3>

<ul>
  <li>Python 3.8.x must be installed. See this <a href="https://docs.python-guide.org/starting/installation/">Python installation guide</a>.</li>
</ul>

<h3 id="tutorials-package">Tutorials Package</h3>

<p>This set of tutorials is accompanied by a Python package consisting of scripts (separated by tutorial module).
These can be found on <a href="https://github.com/gopro/OpenGoPro/tree/main/demos/python/tutorial/">Github</a>. Once the Github repo has been cloned or downloaded to your
local machine, the package can be installed as follows:</p>

<ol>
  <li>Enter the python tutorials directory at <code class="language-plaintext highlighter-rouge">$INSTALL/tutorials/python/</code> where $INSTALL is the top level of the Open GoPro repo
where it exists on your local machine</li>
  <li>Use pip to install the requirements file:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install -r requirements.txt
</code></pre></div></div>

<blockquote>
  <p>This will also install the <a href="www.TODO.com">Open GoPro Python SDK</a> which will be used for some of the optional examples through these tutorials.</p>
</blockquote>

<p>You can test that installation was successful by viewing the installed package‚Äôs information:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>pip show open-gopro-bleak-tutorials
<span class="go">Name: open-gopro-bleak-tutorials
Version: 0.0.1
Summary: Open GoPro Bleak Tutorials
Home-page: https://github.com/gopro/OpenGoPro
Author: GoPro
Author-email: gopro.com
License: MIT
Location: c:\gopro\opengopro\tutorials\python\bleak
Requires: bleak
Required-by:
</span></code></pre></div></div>

<p>The scripts that will be used for this tutorial can be found at in the
<a href="https://github.com/gopro/OpenGoPro/tree/main/demos/python/tutorial/tutorial_modules/tutorial_1_connect_ble">Tutorial 1 Folder</a>.</p>

<h1 id="basic-ble-tutorial">Basic BLE Tutorial</h1>

<p>This tutorial will walk through the process of connecting to the GoPro via Bluetooth Low Energy
(BLE). It is basically just an
explanation of the <code class="language-plaintext highlighter-rouge">ble_connect.py</code>. This same connect functionality will be used as a foundation
for all future BLE tutorials.</p>

<p>Here is a summary of the sequence that will be described in detail in the following
sections:</p>

<p><img class="mermaid" src="https://mermaid.ink/svg/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5wYXJ0aWNpcGFudCBQQ1xucGFydGljaXBhbnQgR29Qcm9cbkdvUHJvLS0-PlBDOiBBZHZlcnRpc2luZ1xuR29Qcm8tLT4-UEM6IEFkdmVydGlzaW5nXG5ub3RlIG92ZXIgUEM6IFNjYW5uaW5nXG5QQy0-PkdvUHJvOiBDb25uZWN0XG5ub3RlIG92ZXIgR29Qcm8sIFBDOiBDb25uZWN0ZWRcbmFsdCBJZiBub3QgUHJldmlvdXNseSBQYWlyZWRcblBDIC0-PiBHb1BybzogUGFpciBSZXF1ZXN0XG5Hb1BybyAtPj4gUEM6IFBhaXIgUmVzcG9uc2VcbmVsc2VcbiUlLVxuZW5kXG5ub3RlIG92ZXIgR29Qcm8sIFBDOiBQYWlyZWRcblBDIC0-PiBHb1BybzogRW5hYmxlIE5vdGlmaWNhdGlvbnMgb24gQ2hhcmFjdGVyaXN0aWMgMVxuUEMgLT4-IEdvUHJvOiBFbmFibGUgTm90aWZpY2F0aW9ucyBvbiBDaGFyYWN0ZXJpc3RpYyAyXG5QQyAtPj4gR29Qcm86IEVuYWJsZSBOb3RpZmljYXRpb25zIG9uIENoYXJhY3RlcmlzdGljIC4uXG5QQyAtPj4gR29Qcm86IEVuYWJsZSBOb3RpZmljYXRpb25zIG9uIENoYXJhY3RlcmlzdGljIE5cbm5vdGUgb3ZlciBHb1BybywgUEM6IFJlYWR5IHRvIENvbW11bmljYXRlIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0"></p>

<h2 id="just-show-me-the-demo">Just Show me the Demo!!</h2>

<p>If you just want to run the demo, you can do:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">python ble_connect.py
</span></code></pre></div></div>

<div class="warning">
<i class="fa fa-exclamation-triangle fa-2x" style="color: #df5142;margin: 0.25em;"></i><span>  Python 3.8.x must be used as specified in the requirements</span>
</div>

<p>See the help for parameter definition:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>python ble_connect.py <span class="nt">--help</span>
<span class="go">usage: ble_connect.py [-h] [-i IDENTIFIER]

Connect to a GoPro camera, pair, then enable notifications.

optional arguments:
  -h, --help            show this help message and exit
  -i IDENTIFIER, --identifier IDENTIFIER
                        Last 4 digits of GoPro serial number, which is the last 4 digits of the default camera SSID. If not used, first discovered GoPro will be connected to
</span></code></pre></div></div>

<h2 id="asyncio">Asyncio</h2>

<p>The bleak module is based on asyncio which means that its awaitable functions need to
be called from an async coroutine. In order to do this, all of the code below should be
running in an async function. We accomplish this in the tutorial scripts
by making <em>main</em> async as such:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Put our code here
</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></div>

<h2 id="advertise">Advertise</h2>

<p>First, we need to ensure the camera is discoverable (i.e. it is advertising).
Ensure that the Camera is powered on, then select
Connections ‚Äì&gt; Connect Device ‚Äì&gt; Quik App</p>

<p>The screen should appear as such:</p>

<figure class="" style="
        display: block;
        text-align: center;
        margin: 10px auto;
    ">
    <img src="/OpenGoPro/assets/images/tutorials/quik.png" alt="Quik" style="
            width: 50%;
            display: block;
            margin-left: auto;
            margin-right: auto;
        "><figcaption>
            Camera is discoverable.

        </figcaption></figure>

<h2 id="scan">Scan</h2>

<div>
    <ul class="tab" data-tab="1be16c20-5a9c-4068-bc2f-821ae8d2a098">
        
            <li class="active">
                <a href="">code </a>
            </li>
        
            <li>
                <a href="">output </a>
            </li>
        
        </ul>
        <ul class="tab-content" id="1be16c20-5a9c-4068-bc2f-821ae8d2a098">
        
            <li class="active">
<p>Next, we must find the GoPro Camera using bleak. Let‚Äôs initialize an empty dict that will
store discovered devices, indexed by name:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Map of devices indexed by name
</span><span class="n">devices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BleakDevice</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></div>

<p>We‚Äôre then going to scan for all devices.
We are passing a scan callback to bleak in order to also find non-connectable scan responses.
We are keeping any devices that have a device name.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Scan callback to also catch nonconnectable scan responses
</span><span class="k">def</span> <span class="nf">_scan_callback</span><span class="p">(</span><span class="n">device</span><span class="p">:</span> <span class="n">BleakDevice</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="c1"># Add to the dict if not unknown
</span>    <span class="k">if</span> <span class="n">device</span><span class="p">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">"Unknown"</span> <span class="ow">and</span> <span class="n">device</span><span class="p">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">devices</span><span class="p">[</span><span class="n">device</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span>

<span class="c1"># Now discover and add connectable advertisements
</span><span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="k">await</span> <span class="n">BleakScanner</span><span class="p">.</span><span class="n">discover</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">detection_callback</span><span class="o">=</span><span class="n">_scan_callback</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">device</span><span class="p">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">"Unknown"</span> <span class="ow">and</span> <span class="n">device</span><span class="p">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">devices</span><span class="p">[</span><span class="n">device</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span>
</code></pre></div></div>

<p>Now we can search through the discovered devices to see if we found a GoPro. Any GoPro
device name will be structured as <code class="language-plaintext highlighter-rouge">GoPro XXXX</code> where XXXX is the last four digits of
your camera‚Äôs serial number.</p>

<p>First, we define a regex which is either ‚ÄúGoPro ‚Äú followed by any four digits if no identifier was passed,
or ‚ÄúGoPro ‚Äú concatenated with the identifier if it exists. In the demo <code class="language-plaintext highlighter-rouge">ble_connect.py</code>, the identifier is taken
from the command-line arguments.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">token</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="sa">r</span><span class="s">"GoPro \d\d\d\d"</span> <span class="k">if</span> <span class="n">identifier</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="sa">f</span><span class="s">"GoPro </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<p>Now we build a list of matched devices by checking if each device‚Äôs name includes the token regex.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">matched_devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BleakDevice</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Now look for our matching device(s)
</span><span class="n">matched_devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">token</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
</code></pre></div></div>

<p>Due to potential RF interference and the asynchronous nature of BLE advertising / scanning, it is possible that
the advertising GoPro will not be discovered by the scanning PC in one scan. Therefore, you may need to redo
the scan (as <code class="language-plaintext highlighter-rouge">ble_connect.py</code> does) until a GoPro is found. That is, <code class="language-plaintext highlighter-rouge">matched_device</code> must contain at least one device.</p>

<p>When running the demo, discovered devices will be logged to the console as they are found. Click the output tab
to see an example of this.</p>

</li>
        
            <li>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">Here is an example of the log from `ble_connect.py` of scanning for devices. Note that this
includes several rescans until the devices was found.

</span><span class="gp">$</span><span class="w"> </span>python ble_connect.py
<span class="go">INFO\:root\:Scanning for bluetooth devices...
INFO\:root\:      Discovered:
INFO\:root\:      Discovered: TR8600 seri
INFO\:root\:Found 0 matching devices.
INFO\:root\:      Discovered:
INFO\:root\:      Discovered: TR8600 seri
INFO\:root\:      Discovered: GoPro Cam
INFO\:root\:      Discovered: GoPro 0456
INFO\:root\:Found 1 matching devices.
</span></code></pre></div></div>

<p>Among other devices, you should see <code class="language-plaintext highlighter-rouge">GoPro XXXX</code> where XXXX is the last four digits of
your camera‚Äôs serial number.</p>

</li>
        
    </ul>
</div>

<h2 id="connect">Connect</h2>

<div>
    <ul class="tab" data-tab="d900c8ad-946f-4afe-93f9-140b895e3d40">
        
            <li class="active">
                <a href="">code </a>
            </li>
        
            <li>
                <a href="">output </a>
            </li>
        
        </ul>
        <ul class="tab-content" id="d900c8ad-946f-4afe-93f9-140b895e3d40">
        
            <li class="active">
<p>Now that we have discovered at least one GoPro device to connect to, the next step is to
establish a BLE connection to the camera as such:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># We're just taking the first device if there are multiple.
</span><span class="n">device</span> <span class="o">=</span> <span class="n">matched_devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</code></pre></div></div>

<p>Click the output tab to see an example of what the log from <code class="language-plaintext highlighter-rouge">ble_connect.py</code> will show.</p>

</li>
        
            <li>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">INFO\:root\:Establishing BLE connection to EF\:5A\:F6\:13\:E6\:5A\: GoPro 0456...
INFO:bleak.backends.dotnet.client:Services resolved for BleakClientDotNet (EF\:5A\:F6\:13\:E6:5A)
INFO\:root\:BLE Connected!
</span></code></pre></div></div>

<p>Here we can see that the connection has successfully been established as well as the GoPro‚Äôs
BLE MAC address.</p>

</li>
        
    </ul>
</div>

<h2 id="pair">Pair</h2>

<p>The GoPro has encryption-protected characteristics which require us to pair before
writing to them. Therefore now that we are connected, we need to attempt to pair:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">pair</span><span class="p">()</span>
<span class="k">except</span> <span class="nb">NotImplementedError</span><span class="p">:</span>
    <span class="c1"># This is expected on Mac
</span>    <span class="k">pass</span>
</code></pre></div></div>

<p>Not all OS‚Äôs allow pairing but some require it. Rather than checking for the OS, we are just
catching the exception when it fails.</p>

<p>Once paired, the camera should beep and display ‚ÄúConnection Successful‚Äù.</p>

<div class="tip">
<i class="fa fa-tools fa-2x" style="color: #ebc21c;margin: 0.25em;"></i><span>  It is now no longer necessary to pair on subsequent connections.</span>
</div>

<h2 id="enable-notifications">Enable Notifications</h2>

<div>
    <ul class="tab" data-tab="d9e1a3f2-8f0b-4c9e-b072-bfa5e2616e35">
        
            <li class="active">
                <a href="">enable </a>
            </li>
        
            <li>
                <a href="">output </a>
            </li>
        
        </ul>
        <ul class="tab-content" id="d9e1a3f2-8f0b-4c9e-b072-bfa5e2616e35">
        
            <li class="active">
<p>As specified in the <a href="/OpenGoPro/ble#sending-and-receiving-messages">Open GoPro Bluetooth API</a>,
we must enable notifications for a given characteristic to receive responses from it.</p>

<div class="note">
<i class="fa fa-clipboard fa-2x" style="color: #3498db;margin: 0.25em;"></i><span>  It is necessary to define a notification handler to pass to the bleak `start_notify` method. Since we
only care about connecting to the device in this tutorial (and not actually receiving data), we are just passing
an empty function. A future tutorial will demonstrate how to use this meaningfully.</span>
</div>

<p>To enable notifications, we loop over each characteristic in each service and enable the characteristic
for notification if it has <code class="language-plaintext highlighter-rouge">notify</code> properties:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">client</span><span class="p">.</span><span class="n">services</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">service</span><span class="p">.</span><span class="n">characteristics</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">"notify"</span> <span class="ow">in</span> <span class="n">char</span><span class="p">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">start_notify</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">notification_handler</span><span class="p">)</span>
</code></pre></div></div>

<p>Go to the next tab to see the log output.</p>

</li>
        
            <li>
<p>Here we can see that notifications are enabled for each characteristic that is notifiable.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">INFO\:root\:Enabling notifications...
INFO\:root\:Enabling notification on char 00002a19-0000-1000-8000-00805f9b34fb
INFO\:root\:Enabling notification on char b5f90073-aa8d-11e3-9046-0002a5d5c51b
INFO\:root\:Enabling notification on char b5f90075-aa8d-11e3-9046-0002a5d5c51b
INFO\:root\:Enabling notification on char b5f90077-aa8d-11e3-9046-0002a5d5c51b
INFO\:root\:Enabling notification on char b5f90079-aa8d-11e3-9046-0002a5d5c51b
INFO\:root\:Enabling notification on char b5f90092-aa8d-11e3-9046-0002a5d5c51b
INFO\:root\:Enabling notification on char b5f90081-aa8d-11e3-9046-0002a5d5c51b
INFO\:root\:Enabling notification on char b5f90083-aa8d-11e3-9046-0002a5d5c51b
INFO\:root\:Enabling notification on char b5f90084-aa8d-11e3-9046-0002a5d5c51b
INFO\:root\:Done enabling notifications
</span></code></pre></div></div>

<p>The characteristics that correspond to each UUID listed in the log can be found in the
<a href="/OpenGoPro/ble#services-and-characteristics">Open GoPro API</a>. These
will be used in a future tutorial to send data.</p>

</li>
        
    </ul>
</div>

<p><strong>Quiz time! üìö ‚úèÔ∏è</strong></p>

<div id="quiz_7510a0f0-7aba-4418-8ff9-2b08e10f64a6" class="quiz">
    <div>
        <div id="question_7510a0f0-7aba-4418-8ff9-2b08e10f64a6" class="quiz__question">How often is it necessary to pair?</div>
        <div id="answers_7510a0f0-7aba-4418-8ff9-2b08e10f64a6">
        
            <input type="radio" name="question" value="A"><label>A: Pairing must occur every time to ensure safe BLE communication.</label>
            <br>
        
            <input type="radio" name="question" value="B"><label>B: We never need to pair as the GoPro does not require it to communicate.</label>
            <br>
        
            <input type="radio" name="question" value="C"><label>C: Pairing only needs to occur once as the keys will be automatically re-used for future connections.</label>
            <br>
        
        </div>
    </div>
    <button onclick="showResults('7510a0f0-7aba-4418-8ff9-2b08e10f64a6', 'C')">Submit Answer</button>
    <div id="results_7510a0f0-7aba-4418-8ff9-2b08e10f64a6" style="display: none">
        <span id="correct_7510a0f0-7aba-4418-8ff9-2b08e10f64a6" style="display: none">  Correct!! üòÉ</span>
        <span id="incorrect_7510a0f0-7aba-4418-8ff9-2b08e10f64a6" style="display: none"> Incorrect!! üò≠ The correct answer is C.</span>
        Pairing is only needed once (assuming neither side deletes the keys). If the
    GoPro deletes the keys (via Connections-&gt;Reset Connections), the devices will need to re-pair.
    </div>
</div>

<h1 id="troubleshooting">Troubleshooting</h1>

<h2 id="complete-system-reset">Complete System Reset</h2>

<p>BLE is a fickle beast. If at any point it is impossible to discover or connect to the camera,
perform the following.</p>

<ol>
  <li>Reset the camera by choosing Connections ‚Äì&gt; Reset Connections</li>
  <li>Use your OS‚Äôs bluetooth settings GUI to remove / unpair the Gopro</li>
  <li>Restart the procedure detailed above</li>
</ol>

<h2 id="logs">Logs</h2>

<p>The demo program has enabled bleak logs and is also using the default <a href="https://docs.python.org/3/library/logging.html">python logging module</a>
to write its own logs.</p>

<p>To enable more bleak logs, follow bleak‚Äôs
<a href="https://bleak.readthedocs.io/en/latest/troubleshooting.html#enable-logging">troubleshooting section</a>.</p>

<h1 id="good-job">Good Job!</h1>

<div class="success">
<i class="fa fa-check-circle fa-2x" style="color: #2dcb71;margin: 0.25em;"></i><span>  Congratulations ü§ô</span>
</div>

<p>You can now successfully connect to the GoPro via BLE and prepare it to receive / send data. To see how
to send commands, you should advance to the next tutorial.</p>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-05-26T11:45:09-07:00">May 26, 2021</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">Previous</a>
    
    
      <a href="/OpenGoPro/tutorials/python/send-ble-commands" class="pagination--pager" title="Python Tutorial 2: Send BLE Commands
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://www.gopro.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
        
          <li><a href="https://twitter.com/GoPro" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://www.facebook.com/gopro/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/gopro" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.instagram.com/gopro/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    
  </ul>
</div>

<div class="page__footer-copyright">¬© 2021 GoPro. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/OpenGoPro/assets/js/main.min.js"></script>




<script src="/OpenGoPro/assets/js/lunr/lunr.min.js"></script>
<script src="/OpenGoPro/assets/js/lunr/lunr-store.js"></script>
<script src="/OpenGoPro/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
